/*

create or replace PACKAGE CFC_LAKAS AUTHID CURRENT_USER AS 
TYPE T_CFC IS TABLE OF VARCHAR2(10 CHAR) INDEX BY PLS_INTEGER;
TYPE T_ALSZEKTOR IS TABLE OF VARCHAR2(10 CHAR) INDEX BY PLS_INTEGER;
procedure CFC_LAKAS;
END CFC_LAKAS;

-------
*/


create or replace PACKAGE BODY CFC_LAKAS AS 
V_CFC T_CFC;
V_ALSZEKTOR T_ALSZEKTOR;

procedure CFC_LAKAS AS

v_lakas VARCHAR2(50);
v_lanc VARCHAR2(50);


BEGIN
V_CFC(1) := 'CFC';
V_CFC(2) := 'NET';
V_CFC(3) := 'GRS';

V_ALSZEKTOR(1) := 'S11';
V_ALSZEKTOR(2) := 'S14';
V_ALSZEKTOR(3) := 'S1313';


v_lakas := 'LAKAS_MEZO_CFC_GRS_NET';
v_lanc := 'C_IMP_AR_LANC_T08_KL_S13_ALAP';

	FOR b IN V_ALSZEKTOR.FIRST..V_ALSZEKTOR.LAST LOOP
	
		FOR a IN V_CFC.FIRST..V_CFC.LAST LOOP
		
			EXECUTE IMMEDIATE'
			INSERT INTO PKD.'|| v_lakas ||'
			(SELECT ''V'', a.OUTPUT, a.SZEKTOR, a.ALSZEKTOR, a.ESZKOZ, a.AGAZAT, ''0'', a.Y1996/b.Y1996_1995 , a.Y1997/b.Y1997_1996, a.Y1998/b.Y1998_1997, a.Y1999/b.Y1999_1998, a.Y2000/b.Y2000_1999, a.Y2001/b.Y2001_2000, a.Y2002/b.Y2002_2001, a.Y2003/b.Y2003_2002, a.Y2004/b.Y2004_2003, a.Y2005/b.Y2005_2004, a.Y2006/b.Y2006_2005, a.Y2007/b.Y2007_2006, a.Y2008/b.Y2008_2007, a.Y2009/b.Y2009_2008, a.Y2010/b.Y2010_2009, a.Y2011/b.Y2011_2010, a.Y2012/b.Y2012_2011, a.Y2013/b.Y2013_2012, a.Y2014/b.Y2014_2013, a.Y2015/b.Y2015_2014, a.Y2016/b.Y2016_2015, a.Y2017/b.Y2017_2016, a.Y2018/b.Y2018_2017
			FROM PKD.'|| v_lakas ||' a
			INNER JOIN PKD.'|| v_lanc ||' b
			ON a.ALSZEKTOR = b.ALSZEKTOR AND a.AGAZAT = b.AGAZAT AND a.ESZKOZ = b.ESZKOZCSP
			WHERE a.OUTPUT = '''|| V_CFC(a) ||'''
			AND a.AGAZAT = ''68'' AND a.ESZKOZ = ''AN111'' AND a.ALSZEKTOR = '''|| V_ALSZEKTOR(b) ||''' AND a.F_V = ''F''
			)
			'
			;
			
		END LOOP;
		
	END LOOP;

END CFC_LAKAS;

END;